<!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <title>Gun Traced back to Chicago over the last ten years</title>
        <link rel="stylesheet" type="text/css" href="css/styles.css">
        <script src="js/min.js"></script>
    </head>

    <body>
        <script>

            var width = 960,
                height = 500;

            var color = d3.scale.threshold()
                .domain([0, 5, 100, 500, 1000, 5000])
                .range(["#f2f0f7", "#dadaeb", "#bcbddc", "#9e9ac8", "#756bb1", "#54278f"]);

            var path = d3.geo.path();

            var svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height);

            queue()
                .defer(d3.json, "js/us.json")
                .defer(d3.csv, "assets/guns-history3.csv")
                .await(ready);

            function ready(error, us, guns) {
                var rateById = {};

                guns.forEach(function(d) { rateById[d.FIPS] = +d.count3; });

                svg.append("g")
                    .attr("class", "counties")
                    .selectAll("path")
                    .data(topojson.feature(us, us.objects.counties).features)
                    .enter().append("path")
                    .attr("d", path)
                    .style("fill", function(d) { return color(rateById[d.id]); });

                svg.append("path")
                    .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a.id !== b.id; }))
                    .attr("class", "states")
                    .attr("d", path);

            } // end ready
        </script>
    </body>